generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model pet_type {
  id              Int               @id @default(autoincrement())
  pet_type_name   String            @unique @db.VarChar(100)
  pets            pet[]
  sitter_pet_type sitter_pet_type[]
}

model role {
  id        Int         @id @default(autoincrement())
  role_name String      @db.VarChar(50)
  user_role user_role[]
}

model sitter {
  id                   Int                       @id @default(autoincrement())
  user_sitter_id       Int
  name                 String?                   @db.VarChar(100)
  location_description String?                   @db.VarChar(255)
  phone                String?                   @db.VarChar(20)
  introduction         String?
  address_detail       String?
  address_province     String?                   @db.VarChar(100)
  address_district     String?                   @db.VarChar(100)
  address_sub_district String?                   @db.VarChar(100)
  address_post_code    String?                   @db.VarChar(10)
  base_price           Decimal?                  @db.Decimal(10, 2)
  created_at           DateTime                  @default(now()) @db.Timestamp(6)
  updated_at           DateTime?                 @db.Timestamp(6)
  experience           Int?
  service_description  String?                   @db.VarChar(1000)
  approval_status_id   Int                       @default(1)
  status_updated_at    DateTime?                 @db.Timestamp(6)
  admin_note           String?                   @db.VarChar(1000)
  latitude             Float?
  longitude            Float?
  reviews              review[]
  approval_status      sitter_approval_status    @relation(fields: [approval_status_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user                 user                      @relation(fields: [user_sitter_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  approval_history     sitter_approval_history[]
  sitter_image         sitter_image[]
  sitter_pet_type      sitter_pet_type[]
}

model sitter_image {
  id        Int    @id @default(autoincrement())
  sitter_id Int
  image_url String @db.VarChar(255)
  sitter    sitter @relation(fields: [sitter_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model user {
  id                      Int                       @id @default(autoincrement())
  name                    String?                   @db.VarChar(100)
  email                   String                    @unique @db.VarChar(100)
  password                String                    @db.VarChar(255)
  phone                   String?                   @db.VarChar(20)
  profile_image           String?                   @db.VarChar(255)
  dob                     DateTime?                 @db.Date
  bank_name               String?                   @db.VarChar(100)
  bank_number             String?                   @db.VarChar(50)
  created_at              DateTime                  @default(now()) @db.Timestamp(6)
  updated_at              DateTime?                 @db.Timestamp(6)
  profile_image_public_id String?                   @db.VarChar(255)
  status                  user_status               @default(ACTIVE)
  approval_status_id      Int                       @default(1)
  status_updated_at       DateTime?                 @db.Timestamp(6)
  admin_note              String?                   @db.VarChar(1000)
  admin                   admin?
  pets                    pet[]
  report                  report[]
  reviews                 review[]
  sitter                  sitter[]
  sitter_approval_history sitter_approval_history[]
  sitter_approval_status  sitter_approval_status    @relation(fields: [approval_status_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user_role               user_role[]

  @@index([approval_status_id], map: "idx_user_approval_status_id")
  @@index([name], map: "idx_user_name")
  @@index([phone], map: "idx_user_phone")
  @@index([status_updated_at], map: "idx_user_status_updated_at")
}

model user_role {
  id      Int  @id @default(autoincrement())
  user_id Int
  role_id Int
  role    role @relation(fields: [role_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user    user @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, role_id])
}

model sitter_pet_type {
  sitter_id   Int
  pet_type_id Int
  pet_type    pet_type @relation(fields: [pet_type_id], references: [id], onDelete: Cascade)
  sitter      sitter   @relation(fields: [sitter_id], references: [id], onDelete: Cascade)

  @@id([sitter_id, pet_type_id])
}

model review {
  id         Int      @id @default(autoincrement())
  sitter_id  Int
  user_id    Int
  rating     Int
  comment    String?  @db.VarChar(500)
  created_at DateTime @default(now())
  sitter     sitter   @relation(fields: [sitter_id], references: [id], onDelete: Cascade)
  user       user     @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model pet {
  id              Int       @id @default(autoincrement())
  owner_id        Int
  pet_type_id     Int
  name            String    @db.VarChar(100)
  breed           String    @db.VarChar(100)
  sex             String    @db.VarChar(10)
  age_month       Int
  color           String    @db.VarChar(100)
  weight_kg       Decimal   @db.Decimal(6, 2)
  about           String?   @db.VarChar(1000)
  image_url       String?   @db.VarChar(255)
  created_at      DateTime  @default(now()) @db.Timestamp(6)
  updated_at      DateTime? @db.Timestamp(6)
  image_public_id String?   @db.VarChar(255)
  owner           user      @relation(fields: [owner_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  pet_type        pet_type  @relation(fields: [pet_type_id], references: [id], onUpdate: NoAction)

  @@index([name], map: "idx_pet_name")
  @@index([owner_id], map: "idx_pet_owner_id")
  @@index([pet_type_id], map: "idx_pet_pet_type_id")
}

model admin {
  id                       Int                       @id @default(autoincrement())
  user_id                  Int                       @unique
  is_active                Boolean                   @default(true)
  created_at               DateTime                  @default(now()) @db.Timestamp(6)
  updated_at               DateTime                  @default(now()) @updatedAt @db.Timestamp(6)
  user                     user                      @relation(fields: [user_id], references: [id], onDelete: Cascade)
  report                   report[]
  approval_history_actions sitter_approval_history[] @relation("ApprovalHistoryAdmin")
}

model sitter_approval_status {
  id          Int      @id @default(autoincrement())
  status_name String   @unique @db.VarChar(50)
  description String?  @db.VarChar(255)
  created_at  DateTime @default(now()) @db.Timestamp(6)
  sitters     sitter[]
  user        user[]
}

model sitter_approval_history {
  id         Int      @id @default(autoincrement())
  sitter_id  Int?
  status_id  Int
  admin_id   Int?
  admin_note String?  @db.VarChar(1000)
  changed_at DateTime @default(now()) @db.Timestamp(6)
  user_id    Int?
  admin      admin?   @relation("ApprovalHistoryAdmin", fields: [admin_id], references: [id])
  sitter     sitter?  @relation(fields: [sitter_id], references: [id], onDelete: Cascade)
  user       user?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_approval_history_user")
}

model report {
  id                  Int           @id @default(autoincrement())
  reporter_id         Int
  handled_by_admin_id Int?
  status              report_status @default(NEW)
  title               String        @db.VarChar(150)
  description         String?       @db.VarChar(2000)
  attachments_json    Json?
  admin_note          String?       @db.VarChar(1000)
  created_at          DateTime      @default(now()) @db.Timestamp(6)
  updated_at          DateTime?     @db.Timestamp(6)
  admin               admin?        @relation(fields: [handled_by_admin_id], references: [id], onUpdate: NoAction, map: "fk_report_admin")
  user                user          @relation(fields: [reporter_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_report_user")

  @@index([created_at], map: "idx_report_created_at")
  @@index([reporter_id], map: "idx_report_reporter")
  @@index([status], map: "idx_report_status")
}

enum report_status {
  NEW
  PENDING
  RESOLVED
  CANCELED
}

enum user_status {
  ACTIVE
  SUSPENDED
}
