# üì± ‡∏£‡∏∞‡∏ö‡∏ö Chat ‡πÅ‡∏ö‡∏ö Real-Time ‡∏î‡πâ‡∏ß‡∏¢ Socket.IO - ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î

## üéØ ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö

‡∏£‡∏∞‡∏ö‡∏ö Chat ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ä‡∏ó‡πÅ‡∏ö‡∏ö Real-Time ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ Socket.IO ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡πÅ‡∏ö‡∏ö‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ Next.js API Routes ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

### üèóÔ∏è ‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡∏£‡∏∞‡∏ö‡∏ö
```
Frontend (React Components) 
    ‚ÜïÔ∏è Socket.IO Connection
Backend (Socket.IO Server)
    ‚ÜïÔ∏è Database Operations
Database (Prisma + PostgreSQL)
```

---

## üìö ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô

### 1. **Socket.IO Fundamentals**
- **WebSocket**: ‡πÇ‡∏õ‡∏£‡πÇ‡∏ï‡∏Ñ‡∏≠‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡πÅ‡∏ö‡∏ö Real-Time
- **Socket.IO**: Library ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ WebSocket ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô
- **Events**: ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡πà‡∏≤‡∏ô events (emit/on)

### 2. **Next.js API Routes**
- **API Routes**: ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á API endpoints ‡πÉ‡∏ô Next.js
- **Request/Response**: ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ HTTP requests ‡πÅ‡∏•‡∏∞ responses

### 3. **React Hooks**
- **useState**: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ state ‡πÉ‡∏ô component
- **useEffect**: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ side effects ‡πÅ‡∏•‡∏∞ lifecycle
- **useContext**: ‡πÅ‡∏ä‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á components

### 4. **Database Concepts**
- **Prisma ORM**: Object-Relational Mapping ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- **Relationships**: ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á (One-to-Many, Many-to-Many)

---

## üóÇÔ∏è ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà

### üìÅ API Endpoints (`src/pages/api/chat/`)

#### 1. **Socket Server** (`socket.ts`)
**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà**: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Socket.IO ‡πÅ‡∏•‡∏∞ Real-Time events

```typescript
// file: pages/api/chat/socket.ts

import { Server } from 'socket.io';           // Import Socket.IO Server
import { NextApiRequest, NextApiResponse } from 'next';  // Next.js API types
import { Socket } from 'socket.io';           // Socket.IO Socket type
import { prisma } from '@/lib/prisma/prisma'; // Database connection
import { SocketEvents, SendMessageData, MessagePayload, UnreadUpdateData } from '@/types/socket.types'; // Type definitions
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 1**: `// file: pages/api/chat/socket.ts` - ‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå‡∏ö‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå
**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 3**: `import { Server } from 'socket.io'` - Import Socket.IO Server class ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á WebSocket server
**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 4**: `import { NextApiRequest, NextApiResponse } from 'next'` - Import types ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Next.js API routes
**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 5**: `import { Socket } from 'socket.io'` - Import Socket type ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏ï‡πà‡∏•‡∏∞ client
**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 6**: `import { prisma } from '@/lib/prisma/prisma'` - Import Prisma client ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 7**: Import types ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Socket events ‡πÅ‡∏•‡∏∞ data structures

```typescript
// Use any type for socket server to avoid type conflicts
type NextApiResponseWithSocket = NextApiResponse & {
  socket: {
    server: any;
  } | null;
};
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 9-14**: ‡∏™‡∏£‡πâ‡∏≤‡∏á type ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö NextApiResponse ‡∏ó‡∏µ‡πà‡∏°‡∏µ socket server property ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Socket.IO server instance

```typescript
export const config = { 
  api: { 
    bodyParser: false 
  } 
};
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 16-20**: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤ config ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Next.js API route ‡πÇ‡∏î‡∏¢‡∏õ‡∏¥‡∏î bodyParser ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ Socket.IO ‡∏à‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏≠‡∏á

```typescript
let io: Server; // Global Instance

interface SocketWithUser extends Socket {
  userId?: string;
  currentChatId?: number;
}
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 22**: `let io: Server` - ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ global ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö Socket.IO server instance
**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 24-27**: ‡∏™‡∏£‡πâ‡∏≤‡∏á interface ‡∏ó‡∏µ‡πà‡∏Ç‡∏¢‡∏≤‡∏¢ Socket ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏° properties ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö userId ‡πÅ‡∏•‡∏∞ currentChatId

```typescript
export default async function socketHandler(req: NextApiRequest, res: NextApiResponseWithSocket) {
  if (!res.socket?.server?.io) {
    // 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á Socket.io Server Instance (Magic Part)
    const httpServer = res.socket!.server;
    io = new Server(httpServer, { 
      path: '/api/chat/socket', 
      cors: { 
        origin: '*', 
        methods: ['GET', 'POST'] 
      } 
    });
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 29**: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Socket.IO server
**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 30**: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Socket.IO server ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á
**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 32**: ‡∏î‡∏∂‡∏á HTTP server ‡∏à‡∏≤‡∏Å Next.js
**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 33**: ‡∏™‡∏£‡πâ‡∏≤‡∏á Socket.IO Server instance ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤:
- `path: '/api/chat/socket'` - path ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Socket.IO connection
- `cors: { origin: '*', methods: ['GET', 'POST'] }` - ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å origin ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ

```typescript
    io.on('connection', (socket: SocketWithUser) => {
      // Event: ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÅ‡∏≠‡∏õ
        socket.on('join_app', async (userId: string) => {
          try {
            (socket as SocketWithUser).userId = userId;
          await prisma.user.update({ 
            where: { id: parseInt(userId) }, 
            data: { is_online: true } 
          });
          socket.join(userId); // ‡πÄ‡∏Ç‡πâ‡∏≤ Private Room ‡∏î‡πâ‡∏ß‡∏¢ ID ‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 41**: `io.on('connection', ...)` - ‡∏ü‡∏±‡∏á event ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ client ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤
**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 43**: `socket.on('join_app', ...)` - ‡∏ü‡∏±‡∏á event ‡πÄ‡∏°‡∏∑‡πà‡∏≠ client ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• userId ‡∏°‡∏≤
**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 45**: ‡πÄ‡∏Å‡πá‡∏ö userId ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô socket object
**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 46-49**: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô online
**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 50**: `socket.join(userId)` - ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° private room ‡∏î‡πâ‡∏ß‡∏¢ userId (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏ô)

```typescript
          // ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ client
          const onlineUsers = await prisma.user.findMany({
            where: { is_online: true },
            select: { id: true },
          });
          
          const onlineUserIds = onlineUsers.map(user => user.id.toString());
          
          // ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ online users ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏´‡πâ client ‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤
          socket.emit('online_users_list', onlineUserIds);
          
          // ‡πÅ‡∏à‡πâ‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ß‡πà‡∏≤‡∏°‡∏µ user ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤
          io.emit('user_online', userId);
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 52-58**: ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 60**: ‡πÅ‡∏õ‡∏•‡∏á user IDs ‡πÄ‡∏õ‡πá‡∏ô string array
**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 63**: `socket.emit('online_users_list', onlineUserIds)` - ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡πÉ‡∏´‡πâ client ‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤
**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 66**: `io.emit('user_online', userId)` - ‡πÅ‡∏à‡πâ‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå

```typescript
      // Event: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°/‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
      socket.on('send_message', async (data: SendMessageData) => {
        try {
          // 1. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°/‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ‡∏•‡∏á‡πÉ‡∏ô DB (Persistence)
          const newMessage = await prisma.message.create({
            data: {
              chat_id: data.chatId,
              sender_id: parseInt(data.senderId),
              content: data.content,
              message_type: data.messageType || 'TEXT',
              image_url: data.imageUrl,
            },
          });
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 71**: `socket.on('send_message', ...)` - ‡∏ü‡∏±‡∏á event ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà
**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 74-82**: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏á‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡πà‡∏≤‡∏ô Prisma:
- `chat_id`: ID ‡∏Ç‡∏≠‡∏á chat room
- `sender_id`: ID ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
- `content`: ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
- `message_type`: ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (TEXT ‡∏´‡∏£‡∏∑‡∏≠ IMAGE)
- `image_url`: URL ‡∏Ç‡∏≠‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)

```typescript
          // 2. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Chat ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
          await prisma.chat.update({ 
            where: { id: data.chatId }, 
            data: { 
              last_message_id: newMessage.id, 
              updated_at: new Date() 
            } 
          });
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 84-91**: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• chat ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö ID ‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï

```typescript
          // 3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ receiver ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏π chat ‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
          const receiverSocket = Array.from(io.sockets.sockets.values()).find(
            socket => (socket as SocketWithUser).userId === data.receiverId
          ) as SocketWithUser;
          const isReceiverViewingThisChat = receiverSocket?.currentChatId === data.chatId;
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 93-98**: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏π chat ‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡πÇ‡∏î‡∏¢‡∏î‡∏π‡∏à‡∏≤‡∏Å currentChatId

```typescript
          // 4. INCREMENT UNREAD COUNT ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á chat ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏π‡∏≠‡∏¢‡∏π‡πà)
          const updatedUserChatSettings = await prisma.user_chat_settings.update({
            where: { 
              user_id_chat_id: { 
                user_id: parseInt(data.receiverId), 
                chat_id: data.chatId 
              } 
            },
            data: { 
              unread_count: isReceiverViewingThisChat 
                ? { set: 0 } // ‡∏ñ‡πâ‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏π‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ set ‡πÄ‡∏õ‡πá‡∏ô 0
                : { increment: 1 }, // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏î‡∏π ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏° 1
              is_hidden: false // ‡πÅ‡∏™‡∏î‡∏á chat ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏£‡∏Å
            },
            select: { unread_count: true }
          });
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 100-115**: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô:
- ‡∏ñ‡πâ‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏π‡∏≠‡∏¢‡∏π‡πà: set ‡πÄ‡∏õ‡πá‡∏ô 0
- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏î‡∏π: ‡πÄ‡∏û‡∏¥‡πà‡∏° 1
- ‡πÅ‡∏™‡∏î‡∏á chat (is_hidden = false) ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà

```typescript
          // 5. Real-Time Delivery ‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πâ‡∏á Unread Badge
          const payload: MessagePayload = { 
            id: newMessage.id.toString(),
            chatId: newMessage.chat_id,
            senderId: newMessage.sender_id.toString(),
            content: newMessage.content || '',
            messageType: newMessage.message_type || 'TEXT',
            imageUrl: newMessage.image_url || undefined,
            timestamp: newMessage.timestamp || new Date(),
            isRead: newMessage.is_read || false,
            senderName: sender?.name || 'Unknown User',
            senderProfileImage: sender?.profile_image || undefined,
            senderProfileImagePublicId: sender?.profile_image_public_id || undefined
          };
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 117-130**: ‡∏™‡∏£‡πâ‡∏≤‡∏á payload ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á client ‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡∏î‡πâ‡∏ß‡∏¢

```typescript
          // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡πÉ‡∏´‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏ô‡∏™‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ô‡∏£‡∏±‡∏ö
          io.to(data.senderId).emit('receive_message', payload);
          io.to(data.receiverId).emit('receive_message', payload);
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 132-134**: ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡πà‡∏≤‡∏ô Socket.IO

#### 2. **Chat List API** (`list.ts`)
**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà**: ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ chat ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ

```typescript
export default async function handle(req: NextApiRequestWithUser, res: NextApiResponse) {
  if (req.method !== 'GET') {
    return res.status(405).json({ message: 'Method Not Allowed' });
  }
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 10-12**: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô GET request ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏à‡∏∞‡∏™‡πà‡∏á error 405

```typescript
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö authentication (‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÉ‡∏´‡πâ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô)
  if (!req.user?.id) {
    const testUserId = req.query.userId as string;
    if (!testUserId) {
      return res.status(401).json({ message: 'Unauthorized - Please add ?userId=YOUR_USER_ID to URL' });
    }
    req.user = { id: testUserId };
  }
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 15-22**: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£ authentication ‡πÇ‡∏î‡∏¢‡∏î‡∏π‡∏à‡∏≤‡∏Å query parameter userId (‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß)

```typescript
    // ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ chat ‡∏ó‡∏µ‡πà user ‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡∏£‡πà‡∏ß‡∏° ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô
    const chats = await prisma.chat.findMany({
      where: {
        AND: [
          {
            OR: [
              { user1_id: currentUserId },
              { user2_id: currentUserId }
            ]
          },
          {
            OR: [
              // Chat ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô
              {
                user_chat_settings: {
                  some: {
                    user_id: currentUserId,
                    is_hidden: false
                  }
                }
              },
              // Chat ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô (‡πÅ‡∏°‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô)
              {
                user_chat_settings: {
                  some: {
                    user_id: currentUserId,
                    unread_count: {
                      gt: 0
                    }
                  }
                }
              }
            ]
          }
        ]
      },
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 27-61**: Query ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á chat ‡∏ó‡∏µ‡πà:
- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (user1_id ‡∏´‡∏£‡∏∑‡∏≠ user2_id)
- ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô

#### 3. **Message API** (`[chatId]/message.ts`)
**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà**: ‡∏î‡∏∂‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á chat ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß

```typescript
  if (req.method === 'GET') {
    try {
      // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ user ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á chat ‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡πÅ‡∏•‡∏∞ chat ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ
      const chat = await prisma.chat.findFirst({
        where: {
          id: chatIdNumber,
          OR: [
            { user1_id: parseInt(currentUserId) },
            { user2_id: parseInt(currentUserId) }
          ]
        },
        include: {
          user_chat_settings: {
            where: {
              user_id: parseInt(currentUserId),
              is_hidden: false // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ chat ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ
            }
          }
        }
      });
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 36-55**: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á chat ‡πÅ‡∏•‡∏∞‡∏ß‡πà‡∏≤ chat ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ

```typescript
      // 3. ‚≠êÔ∏è LOGIC ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: RESET UNREAD COUNT ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
      await prisma.user_chat_settings.update({
        where: { 
          user_id_chat_id: { 
            user_id: parseInt(currentUserId), 
            chat_id: chatIdNumber 
          } 
        },
        data: { unread_count: 0 }, // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏ö
      });

      // 4. ‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ß‡πà‡∏≤ "‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß"
      await prisma.message.updateMany({
        where: {
          chat_id: chatIdNumber,
          NOT: { sender_id: parseInt(currentUserId) }, // ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö
          is_read: false,
        },
        data: {
          is_read: true,
        },
      });
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 77-98**: ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π chat:
- ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï unread_count ‡πÄ‡∏õ‡πá‡∏ô 0
- ‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß

#### 4. **Create Chat API** (`create.ts`)
**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà**: ‡∏™‡∏£‡πâ‡∏≤‡∏á chat ‡πÉ‡∏´‡∏°‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ 2 ‡∏Ñ‡∏ô

```typescript
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ chat ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    const existingChat = await prisma.chat.findFirst({
      where: {
        OR: [
          { user1_id: currentUserId, user2_id: otherUserIdNumber },
          { user1_id: otherUserIdNumber, user2_id: currentUserId }
        ]
      }
    });

    if (existingChat) {
      // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ chat ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á chat ID ‡∏Å‡∏•‡∏±‡∏ö
      return res.json({
        success: true,
        chatId: existingChat.id,
        isNewChat: false,
        message: 'Chat already exists'
      });
    }
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 43-61**: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ chat ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡∏™‡πà‡∏á chat ID ‡∏Å‡∏•‡∏±‡∏ö

```typescript
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á chat ‡πÉ‡∏´‡∏°‡πà
    const newChat = await prisma.chat.create({
      data: {
        user1_id: currentUserId,
        user2_id: otherUserIdNumber,
        updated_at: new Date()
      }
    });

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á user_chat_settings ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏Ñ‡∏ô
    await prisma.user_chat_settings.createMany({
      data: [
        {
          user_id: currentUserId,
          chat_id: newChat.id,
          unread_count: 0,
          is_hidden: false // ‡∏ù‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏Å‡∏î Send Message ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        },
        {
          user_id: otherUserIdNumber,
          chat_id: newChat.id,
          unread_count: 0,
          is_hidden: true // ‡∏ù‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∞‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        }
      ]
    });
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 63-88**: ‡∏™‡∏£‡πâ‡∏≤‡∏á chat ‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ user_chat_settings:
- ‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏° chat ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (is_hidden: false)
- ‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∞‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (is_hidden: true)

---

### üìÅ Components (`src/components/chat/`)

#### 1. **SocketProvider** (`SocketProvider.tsx`)
**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà**: Context Provider ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Socket.IO connection ‡πÅ‡∏•‡∏∞ state

```typescript
interface SocketContextType {
  socket: any;                    // Socket.IO instance
  isConnected: boolean;           // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
  isLoading: boolean;             // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î
  isAuthenticated: boolean;       // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£ login
  userId: string | undefined;     // ID ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
  sendMessage: (data: any) => void; // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
  messages: MessagePayload[];     // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö
  unreadUpdates: UnreadUpdateData[]; // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï unread count
  onlineUsers: string[];          // ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå
}
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 5-15**: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î interface ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Context ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏ä‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Socket.IO ‡πÑ‡∏õ‡∏¢‡∏±‡∏á components ‡∏≠‡∏∑‡πà‡∏ô

```typescript
export const SocketProvider: React.FC<SocketProviderProps> = ({ children }) => {
  const { socket, isConnected, isLoading, isAuthenticated, userId } = useSocket();
  const [messages, setMessages] = useState<MessagePayload[]>([]);
  const [unreadUpdates, setUnreadUpdates] = useState<UnreadUpdateData[]>([]);
  const [onlineUsers, setOnlineUsers] = useState<string[]>([]);
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 31-35**: ‡πÉ‡∏ä‡πâ useSocket hook ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Socket.IO ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á state ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

```typescript
  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
  const sendMessage = (data: any) => {
    if (socket && socket.connected) {
      socket.emit('send_message', data);
    } else {
      console.error('Socket not connected. Cannot send message.');
    }
  };
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 37-44**: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡πà‡∏≤‡∏ô Socket.IO ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô

```typescript
  useEffect(() => {
    // ‡πÇ‡∏´‡∏•‡∏î online users ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏à‡∏≤‡∏Å API
    const fetchOnlineUsers = async () => {
      try {
        const response = await fetch('/api/chat/online-users');
        const data = await response.json();
        
        if (data.success) {
          console.log('Loaded initial online users:', data.onlineUsers);
          setOnlineUsers(data.onlineUsers);
        }
      } catch (error) {
        console.error('Error fetching online users:', error);
      }
    };

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠ component mount
    if (isConnected) {
      fetchOnlineUsers();
    }
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 46-65**: ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏à‡∏≤‡∏Å API ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Socket.IO ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß

```typescript
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ custom events
    const handleReceiveMessage = (event: CustomEvent<MessagePayload>) => {
      console.log('Received message via custom event:', event.detail);
      setMessages(prev => [...prev, event.detail]);
    };

    const handleUnreadUpdate = (event: CustomEvent<UnreadUpdateData>) => {
      console.log('Unread update via custom event:', event.detail);
      setUnreadUpdates(prev => [...prev, event.detail]);
    };
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 67-76**: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ events ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å Socket.IO:
- `handleReceiveMessage`: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô state
- `handleUnreadUpdate`: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô

#### 2. **ChatWidget** (`ChatWidget.tsx`)
**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà**: Component ‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏° ChatList ‡πÅ‡∏•‡∏∞ ChatContainer ‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô

```typescript
interface User {
  id: number;
  name: string | null;
  email: string;
  profile_image: string | null;
  is_online: boolean | null;
  last_seen: Date | null;
}

interface Chat {
  id: number;
  user1_id: number;
  user2_id: number;
  last_message_id: number | null;
  updated_at: Date | null;
  user1: User;
  user2: User;
  last_message?: Message;
  unread_count?: number;
}
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 8-28**: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î interfaces ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö User ‡πÅ‡∏•‡∏∞ Chat objects

```typescript
export default function ChatWidget() {
  const [selectedChatId, setSelectedChatId] = useState<string>('');
  const [chats, setChats] = useState<Chat[]>([]);
  const [messages, setMessages] = useState<Message[]>([]);
  const [loading, setLoading] = useState(true);
  const { isConnected, sendMessage, userId, onlineUsers, messages: socketMessages, socket } = useSocketContext();
  const router = useRouter();
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 52-58**: ‡∏™‡∏£‡πâ‡∏≤‡∏á state variables ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ SocketProvider context:
- `selectedChatId`: ID ‡∏Ç‡∏≠‡∏á chat ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡∏π‡πà
- `chats`: ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ chat ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- `messages`: ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô chat ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
- `loading`: ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î
- `useSocketContext()`: ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å SocketProvider

```typescript
  const scrollToBottom = () => {
    // ‡πÉ‡∏ä‡πâ requestAnimationFrame ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ DOM ‡πÑ‡∏î‡πâ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÅ‡∏•‡πâ‡∏ß
    requestAnimationFrame(() => {
      const scrollContainer = document.querySelector('.overflow-y-auto');
      if (scrollContainer) {
        scrollContainer.scrollTop = scrollContainer.scrollHeight;
      }
    });
  };
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 60-68**: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô scroll ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°

```typescript
  // Convert real data to ChatListItem format for ChatList component
  const chatListItems: ChatListItem[] = chats.map(chat => {
    const otherUser = chat.user1_id === parseInt(userId || '0') ? chat.user2 : chat.user1;
    const lastMessage = chat.last_message;
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏à‡∏≤‡∏Å onlineUsers array
    const isOnline = onlineUsers.includes(otherUser.id.toString());
    
    return {
      id: chat.id.toString(),
      name: otherUser.name || 'Unknown User',
      lastMessage: lastMessage ? 
        (lastMessage.sender_id === parseInt(userId || '0') ? `You: ${lastMessage.content}` : lastMessage.content || '') : 
        'No messages yet',
      timestamp: lastMessage?.timestamp ? 
        new Date(lastMessage.timestamp).toLocaleTimeString('en-US', { 
          hour: 'numeric', 
          minute: '2-digit',
          hour12: true 
        }) : 
        'No time',
      avatar: otherUser.profile_image || '/images/avatar-default.png',
      unreadCount: chat.unread_count || 0,
      isOnline: isOnline
    };
  });
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 72-97**: ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• chat ‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà ChatList component ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£:
- ‡∏´‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ô chat
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå
- ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤

```typescript
  // Fetch chats list
  const fetchChats = async () => {
    try {
      const response = await axios.get('/api/chat/list', {
        params: {
          userId: userId // ‡∏™‡πà‡∏á userId ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö authentication
        }
      });
      
      if (response.data.success) {
        setChats(response.data.chats);
        // Auto-select first chat if none selected ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ chatId ‡∏à‡∏≤‡∏Å URL
        const { chatId } = router.query;
        if (!selectedChatId && !chatId && response.data.chats.length > 0) {
          setSelectedChatId(response.data.chats[0].id.toString());
        }
      }
    } catch (error) {
      console.error('Error fetching chats:', error);
      if (axios.isAxiosError(error)) {
        console.error('Error details:', error.response?.data);
      }
    } finally {
      setLoading(false);
    }
  };
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 99-124**: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ chat ‡∏à‡∏≤‡∏Å API:
- ‡∏™‡πà‡∏á userId ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö authentication
- Auto-select chat ‡πÅ‡∏£‡∏Å‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error cases

```typescript
  // Fetch messages for selected chat
  const fetchMessages = async (chatId: string) => {
    try {
      const response = await axios.get(`/api/chat/${chatId}/message`, {
        params: {
          userId: userId // ‡∏™‡πà‡∏á userId ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö authentication
        }
      });
      
      if (response.data.success) {
        setMessages(response.data.messages);
        // Scroll ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        setTimeout(() => {
          scrollToBottom();
        }, 100);
      }
    } catch (error) {
      console.error('Error fetching messages:', error);
      if (axios.isAxiosError(error)) {
        console.error('Error details:', error.response?.data);
          if (error.response?.status === 403) {
            setMessages([]); // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á
        }
      }
    }
  };
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 126-151**: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô chat ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:
- ‡∏™‡πà‡∏á userId ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö authentication
- Scroll ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á (403 error)

```typescript
  // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏±‡∏ö socket messages real-time
  useEffect(() => {
    if (socketMessages.length > 0) {
      const latestMessage = socketMessages[socketMessages.length - 1];
      if (latestMessage.chatId.toString() === selectedChatId) {
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô messages state
        const newMessage: Message = {
          id: parseInt(latestMessage.id),
          chat_id: latestMessage.chatId,
          sender_id: parseInt(latestMessage.senderId),
          message_type: latestMessage.messageType,
          content: latestMessage.content,
          image_url: latestMessage.imageUrl || null,
          timestamp: latestMessage.timestamp,
          is_read: latestMessage.isRead,
          sender: {
            id: parseInt(latestMessage.senderId),
            name: latestMessage.senderName,
            email: '',
            profile_image: latestMessage.senderProfileImage || null,
            is_online: null,
            last_seen: null
          }
        };
        
        setMessages(prev => [...prev, newMessage]);
        
        // Scroll ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà
        setTimeout(() => {
          scrollToBottom();
        }, 50);
      }
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 191-222**: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å Socket.IO ‡πÅ‡∏ö‡∏ö real-time:
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô chat ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏π‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
- ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Socket.IO ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö Message
- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô state
- Scroll ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î

```typescript
  const handleSendMessage = async (message: string) => {
    if (!message.trim() || !isConnected || !selectedChatId) return;

    const selectedChat = chats.find(chat => chat.id.toString() === selectedChatId);
    if (!selectedChat) return;

    const receiverId = selectedChat.user1_id === parseInt(userId || '0') 
      ? selectedChat.user2_id.toString() 
      : selectedChat.user1_id.toString();

    const messageData = {
      chatId: parseInt(selectedChatId),
      senderId: userId!,
      receiverId: receiverId,
      content: message,
      messageType: 'TEXT',
    };

    sendMessage(messageData);
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 333-351**: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°:
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
- ‡∏´‡∏≤ receiver ID ‡∏à‡∏≤‡∏Å chat data
- ‡∏™‡∏£‡πâ‡∏≤‡∏á messageData object
- ‡∏™‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô Socket.IO

#### 3. **ChatContainer** (`ChatContainer.tsx`)
**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà**: ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞ input ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°

```typescript
interface Message {
  id: string;
  message: string;
  sender: 'user' | 'other';
  avatar?: string;
  timestamp: string;
  isImage?: boolean;
  imageUrl?: string;
}
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 6-14**: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î interface ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Message object

```typescript
const ChatContainer: React.FC<ChatContainerProps> = ({ 
  className = '',
  selectedChat,
  messages = sampleMessages,
  onSendMessage,
  hasChats = true
}) => {
  const scrollContainerRef = useRef<HTMLDivElement>(null);
  const [messageInput, setMessageInput] = useState('');
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 31-37**: ‡∏£‡∏±‡∏ö props ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á state:
- `scrollContainerRef`: reference ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö scroll container
- `messageInput`: ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå

```typescript
  // Auto scroll to bottom when messages change
  useEffect(() => {
    if (scrollContainerRef.current && messages.length > 0) {
      // ‡πÉ‡∏ä‡πâ requestAnimationFrame ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ DOM ‡πÑ‡∏î‡πâ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÅ‡∏•‡πâ‡∏ß
      requestAnimationFrame(() => {
        if (scrollContainerRef.current) {
          scrollContainerRef.current.scrollTop = scrollContainerRef.current.scrollHeight;
        }
      });
    }
  }, [messages]);
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 41-51**: Auto scroll ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà:
- ‡πÉ‡∏ä‡πâ `requestAnimationFrame` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ DOM ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß
- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ `scrollTop` ‡πÄ‡∏õ‡πá‡∏ô `scrollHeight`

```typescript
  const handleSendMessage = () => {
    if (!messageInput.trim()) return;
    
    if (onSendMessage) {
      onSendMessage(messageInput);
    }
    setMessageInput('');
    
    // Scroll ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
    setTimeout(() => {
      if (scrollContainerRef.current) {
        scrollContainerRef.current.scrollTop = scrollContainerRef.current.scrollHeight;
      }
    }, 100);
  };
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 65-79**: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°:
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡πà‡∏≤‡∏á
- ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `onSendMessage` callback
- ‡∏•‡πâ‡∏≤‡∏á input
- Scroll ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î

#### 4. **ChatBubble** (`ChatBubble.tsx`)
**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà**: ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö bubble

```typescript
const ChatBubble: React.FC<ChatBubbleProps> = ({
  message,
  sender,
  avatar,
  timestamp,
  isImage = false,
  imageUrl
}) => {
  
  const isUser = sender === 'user';
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 13-22**: ‡∏£‡∏±‡∏ö props ‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

```typescript
  return (
    <div className="mb-4">
      {/* Timestamp - Center aligned like Facebook */}
      {timestamp && (
        <div className="flex justify-center mb-2">
          <span className="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded-full">
            {timestamp}
          </span>
        </div>
      )}
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 25-33**: ‡πÅ‡∏™‡∏î‡∏á timestamp ‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô Facebook

```typescript
      <div className={`flex ${isUser ? 'justify-end' : 'justify-start'} mb-1`}>
        <div className={`flex ${isUser ? 'flex-row-reverse' : 'flex-row'} items-end max-w-[70%]`}>
          {/* Avatar - Only show for incoming messages */}
          {avatar && !isUser && (
            <div className="flex-shrink-0 mr-3">
              <div className="w-8 h-8 rounded-full overflow-hidden">
                <Image
                  src={avatar}
                  alt="Avatar"
                  className="w-full h-full object-cover"
                  width={32}
                  height={32}
                />
              </div>
            </div>
          )}
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 35-50**: ‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á avatar ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤

```typescript
          {/* Message Bubble */}
          <div
            className={`px-4 py-3 max-w-full rounded-lg ${
              isUser
                ? 'bg-orange-500 text-white' // Orange background for user messages
                : 'bg-white border border-gray-200 text-gray-900' // White background for other messages
            }`}
          >
            {isImage && imageUrl ? (
              <div className="rounded-lg overflow-hidden">
                <Image
                  src={imageUrl}
                  alt="Message image"
                  className="max-w-full max-h-64 object-contain"
                  width={200}
                  height={200}
                />
              </div>
            ) : (
              <p className="text-sm leading-relaxed">{message}</p>
            )}
          </div>
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 52-75**: ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö bubble:
- ‡∏™‡∏µ‡∏™‡πâ‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
- ‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û

#### 5. **ChatList** (`ChatList.tsx`)
**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà**: ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ chat ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

```typescript
const ChatList: React.FC<ChatListProps> = ({ 
  selectedChatId = '', 
  onChatSelect,
  className = '',
  chats = []
}) => {
  const handleChatSelect = (chatId: string) => {
    if (onChatSelect) {
      onChatSelect(chatId);
    }
  };
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 21-31**: ‡∏£‡∏±‡∏ö props ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å chat

```typescript
  return (
    <div className={`w-80 bg-black flex flex-col ${className}`}>
      {/* Messages Header */}
      <div className="p-6 border-b border-gray-800">
        <h2 className="text-white text-2xl font-bold">Messages</h2>
      </div>
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 33-38**: ‡πÅ‡∏™‡∏î‡∏á header ‡∏Ç‡∏≠‡∏á chat list

```typescript
      {/* Chat List */}
      <div className="flex-1 overflow-y-auto">
        {chats.length === 0 ? (
          <div className="flex items-center justify-center h-full">
            <div className="text-center text-gray-400">
              <p>No conversations yet</p>
              <p className="text-sm mt-2">Start chatting with someone!</p>
            </div>
          </div>
        ) : (
          chats.map((chat) => {
            const isSelected = selectedChatId === chat.id;
            
            return (
              <div
                key={chat.id}
                onClick={() => handleChatSelect(chat.id)}
                className={`p-4 cursor-pointer transition-colors duration-200 border-b border-gray-800 ${
                  isSelected
                    ? 'bg-gray-700' // selected state
                    : 'bg-black hover:bg-gray-900' // default state
                }`}
              >
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 40-61**: ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ chat ‡∏´‡∏£‡∏∑‡∏≠ empty state:
- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ chat ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
- ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ chat ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏£‡πâ‡∏≠‡∏° hover effects

```typescript
                <div className="flex items-center space-x-3">
                  {/* Avatar */}
                  <div className="relative flex-shrink-0">
                    <div className="w-12 h-12 rounded-full overflow-hidden">
                      <Image
                        src={chat.avatar}
                        alt={chat.name}
                        className="w-full h-full object-cover"
                        width={48}
                        height={48}
                      />
                    </div>
                    {/* Online indicator */}
                    {chat.isOnline && (
                      <div className="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-black rounded-full"></div>
                    )}
                  </div>
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 63-78**: ‡πÅ‡∏™‡∏î‡∏á avatar ‡πÅ‡∏•‡∏∞ online indicator:
- ‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏ô‡∏≤‡∏î 48x48
- ‡∏à‡∏∏‡∏î‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå

```typescript
                  {/* Chat Info */}
                  <div className="flex-1 min-w-0">
                    <div className="flex items-center justify-between">
                      <h4 className="text-sm font-medium truncate text-white">
                        {chat.name}
                      </h4>
                      <span className="text-xs text-gray-400 ml-2">
                        {chat.timestamp}
                      </span>
                    </div>
                    
                    <div className="flex items-center justify-between mt-1">
                      <p className="text-sm truncate text-gray-300">
                        {chat.lastMessage}
                      </p>
                      
                      {/* Unread count badge */}
                      {chat.unreadCount > 0 && (
                        <div className="flex-shrink-0 ml-2">
                          <span className="inline-flex items-center justify-center px-2 py-1 text-xs font-bold text-white bg-red-500 rounded-full min-w-[20px] h-5">
                            {chat.unreadCount > 99 ? '99+' : chat.unreadCount}
                          </span>
                        </div>
                      )}
                    </div>
                  </div>
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 80-105**: ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• chat:
- ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤
- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
- Badge ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô

---

### üìÅ Hooks (`src/hooks/`)

#### 1. **useSocket** (`useSocket.ts`)
**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà**: Hook ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Socket.IO connection

```typescript
export const useSocket = () => {
  const { data: session, status } = useSession();
  const socketRef = useRef<Socket<SocketEvents> | null>(null);
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 7-9**: ‡πÉ‡∏ä‡πâ NextAuth session ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á ref ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Socket.IO

```typescript
  useEffect(() => {
    // ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ socket ‡πÄ‡∏°‡∏∑‡πà‡∏≠ user login ‡πÅ‡∏•‡πâ‡∏ß
    if (status === 'authenticated' && session?.user?.id) {
      console.log('Connecting socket for user:', session.user.id);
      socketRef.current = connectSocket(session.user.id);
    }

    // disconnect ‡πÄ‡∏°‡∏∑‡πà‡∏≠ user logout ‡∏´‡∏£‡∏∑‡∏≠ component unmount
    return () => {
      if (socketRef.current) {
        console.log('Disconnecting socket');
        disconnectSocket();
        socketRef.current = null;
      }
    };
  }, [status, session?.user?.id]);
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 11-26**: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Socket.IO connection:
- ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠ user login ‡πÅ‡∏•‡πâ‡∏ß
- Disconnect ‡πÄ‡∏°‡∏∑‡πà‡∏≠ logout ‡∏´‡∏£‡∏∑‡∏≠ component unmount

#### 2. **useCreateChat** (`useCreateChat.ts`)
**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà**: Hook ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á chat ‡πÉ‡∏´‡∏°‡πà

```typescript
export const useCreateChat = () => {
  const [loading, setLoading] = useState(false);
  const router = useRouter();
  const { data: session } = useSession();
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 8-11**: ‡∏™‡∏£‡πâ‡∏≤‡∏á state ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ Next.js router ‡πÅ‡∏•‡∏∞ session

```typescript
  const createChatAndNavigate = async (otherUserId: number) => {
    if (!session?.user?.id) {
      console.error('User not authenticated');
      return;
    }

    setLoading(true);
    
    try {
      const response = await axios.post('/api/chat/create', {
        otherUserId: otherUserId
      }, {
        params: {
          userId: session.user.id
        }
      });

      if (response.data.success) {
        // ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ chat ‡∏û‡∏£‡πâ‡∏≠‡∏° chatId
        router.push(`/chat?chatId=${response.data.chatId}`);
      } else {
        console.error('Failed to create chat:', response.data.message);
        // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ chat ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏™‡πà‡∏á chatId
        router.push('/chat');
      }
    } catch (error) {
      console.error('Error creating chat:', error);
      if (axios.isAxiosError(error)) {
        console.error('Error details:', error.response?.data);
        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô error 403 ‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏£‡∏≤‡∏∞ chat ‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ
        if (error.response?.status === 403) {
          console.log('Chat might be hidden, trying to navigate anyway');
          // ‡∏•‡∏≠‡∏á‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ chat ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏™‡πà‡∏á chatId
          router.push('/chat');
        }
      }
    } finally {
      setLoading(false);
    }
  };
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 13-52**: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á chat ‡πÅ‡∏•‡∏∞‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ chat:
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£ authentication
- ‡∏™‡πà‡∏á request ‡πÑ‡∏õ‡∏¢‡∏±‡∏á API
- ‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ chat ‡∏û‡∏£‡πâ‡∏≠‡∏° chatId
- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error cases

---

### üìÅ Utils (`src/utils/`)

#### 1. **Socket Utils** (`socket.ts`)
**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà**: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Socket.IO connection

```typescript
let socket: Socket<SocketEvents> | null = null;

export const connectSocket = (userId: string): Socket<SocketEvents> => {
  // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ socket ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ disconnect ‡∏Å‡πà‡∏≠‡∏ô
  if (socket && socket.connected) {
    console.log('Disconnecting existing socket before reconnecting');
    socket.disconnect();
    socket = null;
  }
  
  console.log('Creating new socket connection for user:', userId);
  socket = io({ 
    path: '/api/chat/socket',
    autoConnect: true,
    forceNew: true // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á connection ‡πÉ‡∏´‡∏°‡πà
  });
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 6-20**: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Socket.IO:
- Disconnect connection ‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô
- ‡∏™‡∏£‡πâ‡∏≤‡∏á connection ‡πÉ‡∏´‡∏°‡πà‡∏î‡πâ‡∏ß‡∏¢ userId
- ‡πÉ‡∏ä‡πâ `forceNew: true` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á connection ‡πÉ‡∏´‡∏°‡πà

```typescript
  socket.on('connect', () => {
    console.log('Socket connected successfully');
    socket?.emit('join_app', userId); // ‡∏™‡πà‡∏á ID ‡πÑ‡∏õ‡πÉ‡∏´‡πâ Server ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Private Room ‡πÅ‡∏•‡∏∞ Presence
  });

  socket.on('connect_error', (error) => {
    console.error('Socket connection error:', error);
  });

  socket.on('disconnect', (reason) => {
    console.log('Socket disconnected:', reason);
  });
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 22-34**: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Socket.IO events:
- `connect`: ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏à‡∏∞‡∏™‡πà‡∏á `join_app` event
- `connect_error`: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
- `disconnect`: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠ disconnect

```typescript
  // ‡πÄ‡∏û‡∏¥‡πà‡∏° Listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Real-Time Unread Badge Update
  socket.on('unread_update', (data) => {
    console.log('Unread Badge Update:', data);
    // ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ dispatch event ‡∏´‡∏£‡∏∑‡∏≠ callback ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÑ‡∏î‡πâ
    window.dispatchEvent(new CustomEvent('socket:unread_update', { detail: data }));
  });

  socket.on('receive_message', (message) => {
    console.log('Received message:', message);
    // ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ dispatch event ‡∏´‡∏£‡∏∑‡∏≠ callback ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÑ‡∏î‡πâ
    window.dispatchEvent(new CustomEvent('socket:receive_message', { detail: message }));
  });
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 36-47**: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ events ‡∏à‡∏≤‡∏Å server:
- `unread_update`: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô
- `receive_message`: ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà
- ‡πÉ‡∏ä‡πâ `window.dispatchEvent` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á components ‡∏≠‡∏∑‡πà‡∏ô

---

### üìÅ Types (`src/types/`)

#### 1. **Socket Types** (`socket.types.ts`)
**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà**: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î types ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Socket.IO events ‡πÅ‡∏•‡∏∞ data structures

```typescript
export interface SocketEvents {
  // Client to Server events
  join_app: (userId: string) => void;
  send_message: (data: SendMessageData) => void;
  disconnect: () => void;

  // Server to Client events
  user_online: (userId: string) => void;
  user_offline: (userId: string) => void;
  receive_message: (message: MessagePayload) => void;
  unread_update: (data: UnreadUpdateData) => void;
  online_users_list: (onlineUsers: string[]) => void;
  chat_list_update: (data: ChatListUpdateData) => void;
}
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 4-17**: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î interface ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Socket.IO events:
- **Client to Server**: events ‡∏ó‡∏µ‡πà client ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á server
- **Server to Client**: events ‡∏ó‡∏µ‡πà server ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á client

```typescript
export interface SendMessageData {
  chatId: number;
  senderId: string;
  receiverId: string;
  content: string;
  messageType?: 'TEXT' | 'IMAGE';
  imageUrl?: string;
}
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 19-26**: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î interface ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°:
- `chatId`: ID ‡∏Ç‡∏≠‡∏á chat room
- `senderId`: ID ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á
- `receiverId`: ID ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö
- `content`: ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
- `messageType`: ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (TEXT ‡∏´‡∏£‡∏∑‡∏≠ IMAGE)
- `imageUrl`: URL ‡∏Ç‡∏≠‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)

```typescript
export interface MessagePayload {
  id: string;
  chatId: number;
  senderId: string;
  content: string;
  messageType: string;
  imageUrl?: string;
  timestamp: Date;
  isRead: boolean;
  senderName: string;
  senderProfileImage?: string;
  senderProfileImagePublicId?: string;
}
```

**‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 28-40**: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î interface ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á client:
- ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡∏î‡πâ‡∏ß‡∏¢ (name, profile image)
- ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏ä‡πà‡∏ô timestamp, isRead

---

## üîÑ Flow ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö

### 1. **‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Socket.IO**
```
1. User Login ‚Üí useSocket Hook ‚Üí connectSocket()
2. Socket.IO Client ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á Server
3. Server ‡∏™‡∏£‡πâ‡∏≤‡∏á Socket.IO instance
4. Client ‡∏™‡πà‡∏á 'join_app' event ‡∏û‡∏£‡πâ‡∏≠‡∏° userId
5. Server ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï user.is_online = true
6. Server ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ online users ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
```

### 2. **‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°**
```
1. User ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‚Üí ChatContainer ‚Üí handleSendMessage()
2. ChatWidget ‡∏™‡∏£‡πâ‡∏≤‡∏á messageData object
3. ‡∏™‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô Socket.IO ‚Üí 'send_message' event
4. Server ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
5. Server ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï unread_count
6. Server ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö
7. Client ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‚Üí ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
```

### 3. **‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Real-Time**
```
1. Server ‡∏™‡πà‡∏á 'receive_message' event
2. Socket Utils ‡∏£‡∏±‡∏ö event ‚Üí dispatch CustomEvent
3. SocketProvider ‡∏ü‡∏±‡∏á CustomEvent ‚Üí ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï state
4. ChatWidget ‡∏£‡∏±‡∏ö state ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà
5. Auto scroll ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î
```

### 4. **‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Unread Count**
```
1. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‚Üí Server ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï unread_count
2. Server ‡∏™‡πà‡∏á 'unread_update' event
3. Client ‡∏£‡∏±‡∏ö event ‚Üí ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï badge ‡πÉ‡∏ô ChatList
4. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π chat ‚Üí API mark-read ‚Üí ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï unread_count
```

---

## üéØ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

### 1. **‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Chat ‡πÉ‡∏´‡∏°‡πà**
```typescript
// ‡πÉ‡∏ô component ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á chat
const { createChatAndNavigate, loading } = useCreateChat();

const handleStartChat = () => {
  createChatAndNavigate(otherUserId); // otherUserId ‡πÄ‡∏õ‡πá‡∏ô number
};
```

### 2. **‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°**
```typescript
// ‡πÉ‡∏ô ChatWidget
const handleSendMessage = async (message: string) => {
  const messageData = {
    chatId: parseInt(selectedChatId),
    senderId: userId!,
    receiverId: receiverId,
    content: message,
    messageType: 'TEXT',
  };
  
  sendMessage(messageData); // ‡∏™‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô Socket.IO
};
```

### 3. **‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Real-Time**
```typescript
// ‡πÉ‡∏ô SocketProvider
useEffect(() => {
  const handleReceiveMessage = (event: CustomEvent<MessagePayload>) => {
    setMessages(prev => [...prev, event.detail]);
  };
  
  window.addEventListener('socket:receive_message', handleReceiveMessage);
  
  return () => {
    window.removeEventListener('socket:receive_message', handleReceiveMessage);
  };
}, []);
```

---

## üöÄ ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡πà‡∏≠

### 1. **‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå**
- **‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û**: ‡πÄ‡∏û‡∏¥‡πà‡∏° image upload ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô ChatBubble
- **‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå**: ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ï‡πà‡∏≤‡∏á‡πÜ
- **Typing Indicator**: ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå
- **Message Reactions**: ‡πÄ‡∏û‡∏¥‡πà‡∏° emoji reactions
- **Message Search**: ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô chat

### 2. **‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û**
- **Message Pagination**: ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ö‡∏ö‡πÅ‡∏ö‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤
- **Image Optimization**: ‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á
- **Connection Pooling**: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Socket.IO connections
- **Caching**: Cache ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• chat ‡πÅ‡∏•‡∏∞ messages

### 3. **‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢**
- **Message Encryption**: ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
- **Rate Limiting**: ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
- **Content Moderation**: ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
- **Audit Logs**: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

---

## üìù ‡∏™‡∏£‡∏∏‡∏õ

‡∏£‡∏∞‡∏ö‡∏ö Chat ‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ Socket.IO ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡πÅ‡∏ö‡∏ö Real-Time ‡πÅ‡∏•‡∏∞ Next.js API Routes ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÅ‡∏•‡∏∞‡πÅ‡∏¢‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏±‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏î‡∏µ:

- **API Layer**: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞ Socket.IO server
- **Component Layer**: ‡πÅ‡∏™‡∏î‡∏á UI ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ user interactions
- **Hook Layer**: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ business logic ‡πÅ‡∏•‡∏∞ state
- **Utils Layer**: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏•‡∏∞ Socket.IO utilities
- **Types Layer**: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î types ‡πÅ‡∏•‡∏∞ interfaces

‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏£‡∏∞‡∏ö‡∏ö chat ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á
